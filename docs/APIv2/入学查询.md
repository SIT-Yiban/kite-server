## 概念

入学查询接口利用校有关部门提供的数据，为八、九月份大一新生提供室友和老乡查询服务，服务时效性强。接口主要用于查询和信息更新，不涉及创建和删除。

一些典型的字段包括**学院**（college）、**专业**（major）、**校区**（campus）、**楼号**（building）、**寝室号**（room）、**床位号**（bed）、**班级**（class）、**学号**（studentId）、**辅导员姓名**（counselorName）、**辅导员电话**（counselorTel）、**姓名**（name）、**省份**（province）。除此之外，**隐私**（visible）字段用于控制是否允许老乡可见自己与自己的联系方式，**看过**（lastSeen）字段用于表示该用户最后访问系统的时间。

每位新生账户可以设置个人联系方式可见性、联系方式（QQ、微信、电话号码），接口提供了 PUT 方法用于更新


操作的资源有：

- `/freshman/{account}`

## 权限

本版接口在权限上做了稍许修改，更新如下：

1. 允许单一用户代查询其他人信息。鉴于 `secret` 所代表的身份证号码后 `6` 位较隐私，且因登录凭据和登录方法的保护，不太可能出现爆破或直接获取他人信息的情况。

2. 允许管理员 token 查看其他账户以调试。

## 接口

### GET /freshman/{account}

获取宿舍、辅导员信息等。一般情况下客户端**应该**缓存这份结果。

#### 参数

| 参数    | 类型   | 必填 | 释义                 | 合法值 |
| ------- | ------ | ---- | -------------------- | ------ |
| account | string | 是   | 姓名、学号或准考证号 |        |
| secret  | string | 是   | 身份证号后6位        |        |

#### 响应示例

```json
{
  "code": 0,
  "data": {
    "name": "姓名",
    "uid": 100,
    "studentId": "学号",
    "college": "学院",
    "major": "专业",
    "campus": "奉贤校区",
    "building": "xx号楼",
    "room": 111,
    "bed": "111-01",
    "counselorName": "辅导员姓名",
    "counselorTel": "手机号或固话",
    "visible": false,
  }
}
```



### PUT /freshman/{account}/update

更新用户选项或联系方式信息。

#### 参数

| 参数    | 类型   | 必填 | 释义                     | 合法值                            |
| ------- | ------ | ---- | ------------------------ | --------------------------------- |
| account | string | 是   | 学号、姓名或准考证号     |                                   |
| secret  | string | 是   | 身份证号后6位            |                                   |
| contact | json   | 否   | 联系方式                 | 如 `{"wechat": "w", "qq": 12345}` |
| visible | bool   | 否   | 允许推荐当前账户至其他人 | `true` / `false`                  |

注意，后三个参数作为表单（form）出现在请求体中。

#### 响应示例

```json
{"code":0}
```



### GET /freshman/{account}/roommate

获取新生舍友信息

#### 参数

| 参数    | 类型   | 必填 | 释义                 | 合法值 |
| ------- | ------ | ---- | -------------------- | ------ |
| account | string | 是   | 姓名、学号或准考证号 |        |
| secret  | string | 是   | 身份证号后6位        |        |

#### 响应示例

```json
{"code":0, "data":{
    "roommates": [
    {
        "college": "机械学院",
        "major": "机械学院大类",
        "name": "姓名",
        "province": "省份",
        "bed": "床位号",
        "lastSeen": /* timestamp */,
        "avatar": "https://.../....jpg",
        /* contact 部分由用填写并更新 */
        "contact": { 
            "wechat": "微信号",
            "qq": "qq号",
            "tel": "手机号",
        },
    },  /* ... */ 
    ],
}}
```



### GET /freshman/{account}/familiar

获取可能认识的人。该功能根据地区、学校、邮政编码等判定。

#### 参数

| 参数    | 类型   | 必填 | 释义                 | 合法值     |
| ------- | ------ | ---- | -------------------- | ---------- |
| account | string | 是   | 姓名、学号或准考证号 | 对应合法值 |
| secret  | string | 是   | 身份证号后6位        |            |

#### 响应示例

```json
{"code":0,"data":{
    "fellows": [{
        "name": "姓名",
        "college"： "学院",
        "city": "上海市",
        "gender": "M",
        "avatar": "https://.../....jpg",
        "lastSeen":  /* timestamp */11111,
        // contact 部分由用填写并更新
        "contact": { 
            "wechat": "微信号",
            "qq": "qq号",
            "tel": "手机号",
        }
    }, // ...
    ]
}} // TODO.
```



### GET /freshman/{account}/classmate

获取班级名单。

#### 参数

| 参数    | 类型   | 必填 | 释义                 | 合法值     |
| ------- | ------ | ---- | -------------------- | ---------- |
| account | string | 是   | 姓名、学号或准考证号 | 对应合法值 |
| secret  | string | 是   | 身份证号后6位        |            |

#### 响应示例

```json
{"code":0,"data":{
    "classmates": [{
		"college": "学院",
        "major": "专业",
        "name": "姓名",
        "province": "省份",
        "building": "1号楼",
        "room": 寝室号,
        "bed": "寝室号-01",
        "gender": "M",
        "lastSeen": null,
        "avatar": "https://../icon.png",
        "contact": null
    }, // ...
    ]
}} // TODO.
```



### GET /freshman/{account}/analysis

对该生及全部新生信息进行统计，返回以下数据：

>**新生中**
>
>1. 同名人数
>
>2. 来自同一城市（区，乡）的人数
>
>3. 毕业自同一高中的人数
>4. 专业男女生数
>5. 学院人数，专业人数
>
>**全校范围内**（暂未实现）
>
>1. 同名人数
>2. 来自同一城市（区，乡）的人数
>3. 毕业自同一高中的人数

由于服务器未设置热点缓存，客户端应该尽量缓存这些数据，以减少数据库查询，加快加载。避免在大流量时出现访问问题。

#### 参数

| 参数    | 类型   | 必填 | 释义                 | 合法值     |
| ------- | ------ | ---- | -------------------- | ---------- |
| account | string | 是   | 姓名、学号或准考证号 | 对应合法值 |
| secret  | string | 是   | 身份证号后6位        |            |

#### 响应示例

```json
{
  "code": 0,
  "data": {
    "freshman": {
      "sameName": 1,
      "sameCity": 26,
      "sameHighSchool": 0,
      "collegeCount": 191,
      "major": {
        "total": 181,
        "boys": 43,
        "girls": 138
      }
    }
  }
}
```



### POST /freshman/{account}/analysis/log

对信息统计页面的保存数进行统计 :-)

#### 参数

| 参数    | 类型   | 必填 | 释义                 | 合法值     |
| ------- | ------ | ---- | -------------------- | ---------- |
| account | string | 是   | 姓名、学号或准考证号 | 对应合法值 |
| secret  | string | 是   | 身份证号后6位        |            |

#### 响应示例

```json
{
    "code": 0,
}
```



## 错误代码

| 代码            | 说明                       |
| --------------- | -------------------------- |
| 120             | 无匹配的新生数据           |

## 计划

- [ ] 2019 年的迎新系统在个人信息页面加入了个人爱好和技能的填写，反响不错，可以考虑收集这些信息。
- [x] 设计一个类似于支付宝、网易云年终总结的统计分析页，包括同名同姓数量、省市同学数、生日同一天数等，支持截图分享到朋友圈。