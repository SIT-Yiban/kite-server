# 图书馆预约

## 需求

1. 管理员预先设置好教室和座位数，用一张表存储，同时标记是否可用

   `(校区，房间ID，名称，最大人数，可用标记）`

2. 应该有一个公告查询接口
   `GET /library/notice`，支持 webview 或文本

3. 管理员需要提前设置好可申请的日期段，如3月1日~3月31日，以及上午下午。
   （直接写数据库）

4. 管理员可以获取所有日期的预约记录，在客户端做查找
   `GET /library/application/?date=2021-3-10&campus=校区`

5. 用户可以查看自己的预约记录，可以预约和取消预约

   `GET /library/application/?user=181042Y130` （注意鉴权）  
   `POST /library/application`
   对于用户来说只能申请当天及次日座位。 但是这样要考虑到，如果在00:00 申请了当日和次日的，然后当日不去，次日的凭据应当作废。
   解决方案：申请当日时，将该申请状态设置为逾期，这样次日无法申请。

   `DELETE /library/application` （取消预约，将预约记录移动至 history 表，避免影响下次申请）

6. 用户可以展示自己的预约状态（二维码）并可以保存本地，二维码中包含用户信息、ID、预约日期。该接口应当加签名。页面包含动态时间。
   
   签名方式有两种，一是服务端直接 hash 附后，一是服务端私钥加密、客户端公钥解密。

7. 管理员可以扫码获取用户预约状态（通过二维码，离线），并公钥校验； 放行并标记该用户已到（在线）

   如：`UPDATE /library/application/1`

   {"status": 1}

   因此每一个申请（application）应该包含`（date, uid, room_id, checked）`，前两项为主键。

8. 公共接口：查看某一日可用座位数

   `GET /library/room/`