## 概念

入学查询接口利用校有关部门提供的数据，为八、九月份大一新生提供室友和老乡查询服务，服务时效性强。接口主要用于查询和信息更新，不涉及创建和删除。

一些典型的字段包括**学院**（college）、**专业**（major）、**校区**（campus）、**楼号**（building）、**寝室号**（room）、**床位号**（bed）、**班级**（class）、**学号**（studentId）、**辅导员姓名**（counselorName）、**辅导员电话**（counselorTel）、**姓名**（name）、**省份**（province）。除此之外，**隐私**（visible）字段用于控制是否允许老乡可见自己与自己的联系方式，**看过**（lastSeen）字段用于表示该用户最后访问系统的时间（由客户端提交）。

每位新生账户可以设置个人联系方式可见性、联系方式（QQ、微信、电话号码），接口提供了 `PUT` 方法用于更新。

在下文所述接口调用前，须使用微信登录。当查询请求发生，接口记录并关联微信账号和查询人，并保证一般情况下数据库中账号与首次查询的身份必须一致，以免接口遭到滥用。此外，在设计时，设计者认为我们不会开发相关功能的管理员接口。因此，JWT token 中的管理员相关字段不会被接口识别。

操作的资源有：

- `/freshman/{account}`

> **注意**  使用 `GET` 方法时，参数 `secret` 要写在 `request body` 里面



## 接口

### GET /freshman/{account}

获取宿舍、辅导员信息等。一般情况下客户端**应该**缓存这份结果。

#### 权限

正式用户或关联用户可访问。

#### 参数

| 参数    | 类型   | 必填 | 释义                 | 合法值 |
| ------- | ------ | ---- | -------------------- | ------ |
| account | string | 是   | 姓名、学号或准考证号 |        |
| secret  | string | 是   | 身份证号后6位        |        |

#### 响应示例

```json
{"code":0,"data":{
    "me": {
        "campus": "奉贤校区",
        "building": "1号楼",
        "room": "202",
        "studentId": "学号",
        "bed": "202-01",
        "counselorName": "辅导员姓名", 
        "counselorTel": "电话号码",
        "visible": false,
    },
    // 有其他的两个人和我同名同姓
    "sameNameCount": 2,
}}
```



### PUT /freshman/{account}

#### 权限

已绑定（实名）用户。

#### 参数

| 参数     | 类型   | 必填 | 释义                     | 合法值                            |
| -------- | ------ | ---- | ------------------------ | --------------------------------- |
| account  | string | 是   | 学号、姓名或准考证号     |                                   |
| contact  | json   | 否   | 联系方式                 | 如 `{"wechat": "w", "qq": 12345}` |
| visivble | bool   | 否   | 允许推荐当前账户至其他人 | `true` / `false`                  |
| lastSeen | bool   | 否   | 更新最后一次访问时间     | true                              |

#### 响应示例

```json
{"code":0, "data":{}}
```



### GET /freshman/{account}/roommate

获取新生舍友信息

#### 权限

已绑定（实名）用户。

#### 参数

| 参数    | 类型   | 必填 | 释义                     | 合法值                            |
| ------- | ------ | ---- | ------------------------ | --------------------------------- |
| account | string | 是   | 姓名、学号或准考证号     |                                   |
| contact | json   | 否   | 联系方式                 | 如 `{"wechat": "w", "qq": 12345}` |
| private | bool   | 否   | 允许推荐当前账户至其他人 | `true` / `false`                  |

#### 响应示例

```json
{"code":0, "data":{
    "roommates": [
    {
        "college": "机械学院",
        "major": "机械学院大类",
        "name": "姓名",
        "province": "省份",
        "bed": "床位号",
        "lastSeen": /* timestamp */,
        "avatar": "https://.../....jpg",
        /* contact 部分由用填写并更新 */
        "contact": { 
            "wechat": "微信号",
            "qq": "qq号",
            "tel": "手机号",
        },
    },  /* ... */ 
    ],
}}
```



### GET /freshman/{account}/familiar

获取可能认识的人。该功能根据地区、学校、邮政编码等判定。

#### 权限

已绑定（实名）用户。

#### 参数

| 参数    | 类型   | 必填 | 释义                 | 合法值     |
| ------- | ------ | ---- | -------------------- | ---------- |
| account | string | 是   | 姓名、学号或准考证号 | 对应合法值 |

#### 响应示例

```json
{"code":0,"data":{
    "fellows": [{
        "name": "姓名",
        "college"： "学院",
        "city": "上海市",
        "avatar": "https://.../....jpg",
        "lastSeen":  /* timestamp */11111,
        // contact 部分由用填写并更新
        "contact": { 
            "wechat": "微信号",
            "qq": "qq号",
            "tel": "手机号",
        }
    }, // ...
    ]
}} // TODO.
```



### GET /freshman/{account}/classmate

获取班级名单。

#### 权限

已绑定（实名）用户。

#### 参数

| 参数    | 类型   | 必填 | 释义                 | 合法值     |
| ------- | ------ | ---- | -------------------- | ---------- |
| account | string | 是   | 姓名、学号或准考证号 | 对应合法值 |

#### 响应示例

```json
{"code":0,"data":{
    "classmates": [{
        "name": "姓名",
        "city": "上海市",
        "avatar": "https://.../....jpg",
        "lastSeen": 111,
        // contact 部分由用填写并更新
        "contact": { 
            "wechat": "微信号",
            "qq": "qq号",
            "tel": "手机号",
        }
    }, // ...
    ]
}} // TODO.
```



## 错误代码

| 代码            | 说明                       |
| --------------- | -------------------------- |
| 0               | 查询成功                   |
| 1               | 数据库错误                 |
| SecretNeeded    | 需要给出 secret 才能查询   |
| NoSuchAccount   | 无匹配的新生数据           |
| DismatchAccount | 账户不匹配                 |
| BoundAlready    | 该学生信息已被别的用户绑定 |
| Forbidden       | 未登录                     |

## 计划

- [ ] 2019 年的迎新系统在个人信息页面加入了个人爱好和技能的填写，反响不错，可以考虑收集这些信息。
- [x] 接口返回和自己同名的人数。
- [ ] 设计一个类似于支付宝、网易云年终总结的统计分析页，包括同名同姓数量、省市同学数、生日同一天数等，支持截图分享到朋友圈。