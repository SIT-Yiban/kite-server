## 概念

消费查询包括**校园卡消费**与**宿舍电费**查询。

操作的资源主要有：

- /pay/room/{*room*} 查询电费余额

- /pay/consumption/{*studentId*} 查询消费记录

  

## 接口

### [GET] /pay/room/{*roomId*}

查询房间电费余额（仅支持奉贤校区）。

房间 ID 的计算规则是由电费查询系统规定的。格式为 “10” + 楼号 + 寝室号，如果遇到仅为个位的楼号，不补零。例如，对于1号楼101寝室，对应的房间 ID 为 `101101`。

余额更新可能有延迟，详见校内 OA [相关页面](card.sit.edu.cn)。

#### 权限

普通用户。

#### 参数

| 参数   | 类型   | 必填 | 释义   | 合法值 |
| ------ | ------ | ---- | ------ | ------ |
| roomId | string | 是   | 房间号 |        |

#### 响应示例

```json
{
    "code": 0,
    "msg": "OK",
    "data": {
        "event_id": 12
    }
}
```

### [GET] /pay/room/{*roomId*}/bill/days

按日进行用电统计，所得数值均为正数。

#### 权限

普通用户。

#### 参数

| 参数   | 类型   | 必填 | 释义   | 合法值 |
| ------ | ------ | ---- | ------ | ------ |
| roomId | string | 是   | 房间号 |        |
| start  | string | 否   | 统计开始日期 |  yyyy-mm-dd |
| end    | string | 否   | 统计结束日期 |  yyyy-mm-dd |

1. 若某日数据在数据库中不存在，或该日未消费，接口会将该日消费量记为 0 以便前端使用
2. 若省略 `start`， 则默认从上周该日（7天前）的日期开始，若省略`end`，则默认为截止到今日

#### 响应示例

```json
{
  "code": 0,
  "data": [
    {
      "date": "2020-12-14",
      "charge": 0.0,
      "consumption": 2.5620003
    },
    {
      "date": "2020-12-15",
      "charge": 0.0,
      "consumption": 1.4029999
    }
  ]
}
```


### [GET] /pay/room/{*roomId*}/bill/hours

统计最近一天各小时的用电量。

注意
1. 日期中的各个小时并非实际该小时产生的电费量，而是上一小时产生的电费量。
2. 该接口不支持指定时间范围

#### 权限

普通用户。

#### 参数

| 参数   | 类型   | 必填 | 释义   | 合法值 |
| ------ | ------ | ---- | ------ | ------ |
| roomId | string | 是   | 房间号 |        |


1. `start`、`end` 的格式为 `yyyy-mm-dd`
2. 若某日数据在数据库中不存在，或该日未消费，接口会将该日消费量记为 0 以便前端使用
3. 若省略 `start`， 则默认为上周该日（7天前）的日期，若省略`end`，则默认为今日
4. 数值均为正数

#### 响应示例

```json
{
  "code": 0,
  "data": [
    {
      "time": "2020-12-20 15:00",
      "charge": 0.0,
      "consumption": 0.0
    },
    {
      "time": "2020-12-20 16:00",
      "charge": 0.0,
      "consumption": 0.3050003
    },
    {
      "time": "2020-12-20 17:00",
      "charge": 0.0,
      "consumption": 0.24399948
    },
    {
      "time": "2020-12-20 18:00",
      "charge": 0.0,
      "consumption": 0.3050003
    },
    {
      "time": "2020-12-20 19:00",
      "charge": 0.0,
      "consumption": 0.24400139
    },
    {
      "time": "2020-12-20 20:00",
      "charge": 0.0,
      "consumption": 0.18299866
    },
    {
      "time": "2020-12-20 21:00",
      "charge": 0.0,
      "consumption": 0.18300056
    },
    {
      "time": "2020-12-20 22:00",
      "charge": 0.0,
      "consumption": 0.18300056
    },
    {
      "time": "2020-12-20 23:00",
      "charge": 0.0,
      "consumption": 0.24399948
    },
    {
      "time": "2020-12-21 00:00",
      "charge": 0.0,
      "consumption": 0.18300056
    },
    {
      "time": "2020-12-21 01:00",
      "charge": 0.0,
      "consumption": 0.060998917
    },
    {
      "time": "2020-12-21 02:00",
      "charge": 0.0,
      "consumption": 0.061000824
    },
    {
      "time": "2020-12-21 03:00",
      "charge": 0.0,
      "consumption": 0.060998917
    },
    {
      "time": "2020-12-21 04:00",
      "charge": 0.0,
      "consumption": 0.061000824
    },
    {
      "time": "2020-12-21 05:00",
      "charge": 0.0,
      "consumption": 0.12199974
    },
    {
      "time": "2020-12-21 06:00",
      "charge": 0.0,
      "consumption": 0.0
    },
    {
      "time": "2020-12-21 07:00",
      "charge": 0.0,
      "consumption": 0.061000824
    },
    {
      "time": "2020-12-21 08:00",
      "charge": 0.0,
      "consumption": 0.060998917
    },
    {
      "time": "2020-12-21 09:00",
      "charge": 0.0,
      "consumption": 0.061000824
    },
    {
      "time": "2020-12-21 10:00",
      "charge": 0.0,
      "consumption": 0.060998917
    },
    {
      "time": "2020-12-21 11:00",
      "charge": 0.0,
      "consumption": 0.061000824
    },
    {
      "time": "2020-12-21 12:00",
      "charge": 0.0,
      "consumption": 0.060998917
    },
    {
      "time": "2020-12-21 13:00",
      "charge": 0.0,
      "consumption": 0.12200165
    },
    {
      "time": "2020-12-21 14:00",
      "charge": 0.0,
      "consumption": 0.24399948
    },
    {
      "time": "2020-12-21 15:00",
      "charge": 0.0,
      "consumption": 0.24399948
    }
  ]
}

```

## 错误代码

| 代码 | 说明                                   |
| ---- | -------------------------------------- |
| 200  | 无对应房间数据 | `NoSuchRoom`    |
