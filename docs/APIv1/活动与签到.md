## 概念

签到相关API有四个概念，Event、User、Record、Tag 分别表示活动、用户、签到记录与实体RFID标签。在小程序的实现中，Tag仅**保留**。TODO：传附件

操作的资源主要有：

- /event 新建、列出活动
- /event/{event_id}/ 撤销、编辑活动，查看活动详情
- /event/{event_id}/user 列出活动参与者及参与状况（不支持删除记录）、申请活动
- /user/{uid}/event 列出用户参与的活动（不支持删除记录）
- /event/{event_id}/user/{uid}/record 列出、新建签到记录



## 接口

### [POST] /event

新建一个活动。

#### 权限

实名认证用户。

#### 参数

| 参数          | 类型   | 必填 | 释义                 | 合法值                                             |
| ------------- | ------ | ---- | -------------------- | -------------------------------------------------- |
| title         | string | 是   | 活动标题             |                                                    |
| description   | string | 是   | 活动描述             |                                                    |
| startTime     | int64  | 是   | 活动开始时间         | 不得早于当前时间                                   |
| endTime       | int64  | 是   | 活动结束时间         | 不得早于开始时间                                   |
| tag           | string | 是   | 活动分类             | 机器人爱好者协会                                   |
| maxPeople     | int2   | 是   | 最大参与人数         | 默认为无限制                                       |
| ~~needSign~~  | bool   | 是   | 是否开启签到         | 默认为 false                                       |
| ~~signType~~  | int    | 是   | 签到类型             | 1 表示扫码<br/>2 表示动态口令<br/>3 表示 RFID 标签 |
| ~~needApply~~ | bool   | 是   | 是否需要报名才能签到 | 默认为 false                                       |
| place         | string | 是   | 地点                 |                                                    |
| image         | uuid   | 是   | 题图                 |                                                    |
| attachment    | uuid[] | 否   | 详细介绍中的图片     |                                                    |

#### 错误代码

| 代码 | 说明                                   |
| ---- | -------------------------------------- |
| 0    | 成功创建                               |
| 1    | 内部服务器错误                         |
| 2    | 参数错误，可能是缺少字段，或分类不存在 |
| 4    | 权限不足，可能是未登录                 |
| 8    | 该活动已存在                           |

#### 响应示例

``` json5
{
    "code": 0,
    "msg": "OK",
    "data": { event_id: 12 }
}
```



### [GET] /event

获得活动列表。

#### 权限

访客。

#### 参数

| 参数     | 类型   | 必填 | 释义     | 合法值           |
| -------- | ------ | ---- | -------- | ---------------- |
| pageSize | u32    | 否   | 单页大小 | 默认值由后端决定 |
| index    | u32    | 否   | 页索引   | 默认值由后端决定 |
| filter   | string | 否   | 关键字   | 词语或单词，不支持搜索语法 |
| // tags  | string | 否   | 分类     |  |

#### 错误代码

| 代码 | 说明                       |
| ---- | -------------------------- |
| 0    | 搜索成功                   |
| 1    | 内部服务器错误，日志已记录 |

#### 响应示例

```json
{
    "code": 0,
    "msg": "OK",
    "data": [
        {
            event_id: 12,
            publisher: "somebody",
            title: "",
            place: "",
            startTime: 1586258508,
            endTime: 1586258509,
            tag: "机协",
        },
        // ...
    ]
}
```



### [DELETE]   /event

删除一个活动。

#### 权限

发起者或管理员。

#### 参数

| 参数     | 类型 | 必填 | 释义    | 合法值  |
| -------- | ---- | ---- | ------- | ------- |
| event_id | int  | 是   | 活动 ID |         |

#### 错误代码

| 代码 | 说明                         |
| ---- | ---------------------------- |
| 0    | 成功标记为删除               |
| 1    | 内部服务器错误，日志已记录   |
| 2    | 参数错误，可能是缺少必要字段 |
| 3    | 给定的 token 无效            |
| 9    | 找不到这个活动，已经被删除   |

#### 响应示例

```json
{
    "code": 0,
    "msg": "OK",
    "data": {}
}
```



### [GET]   /event/{event_id}

获得某个活动的详细信息。

#### 权限

已登录用户。

#### 参数

| 参数 | 类型 | 必填 | 释义 | 合法值 |
| ---- | ---- | ---- | ---- | ------ |
|      |      |      |      |        |

#### 错误代码

| 代码 | 说明                       |
| ---- | -------------------------- |
| 0    | 加载成功                   |
| 1    | 内部服务器错误，日志已记录 |
| 9    | 找不到这项活动             |

#### 响应示例

``` json5
{
    "code": 0,
    "msg": "OK",
    "data": [{
        event_id: 12,
        publisherId: 11,
        publisher: "somebody",
        publisherAvatar: "https://",
        title: "",
        description: "...",
        place: "工训一馆 403",
        startTime: 1586258508,
        endTime: 1586258509,
        maxPeople: 200,
        currentPeople: 20, // TODO
    },
     // ...
    ]
}
```



### [GET]   /event/{event_id}/participant

获得报名某个活动的人员。

#### 权限要求

活动发起者或管理员。

#### 参数

| 参数     | 类型 | 必填 | 释义 | 合法值 |
| -------- | ---- | ---- | ---- | ------ |
| pageSize | int  | 否   |      |        |
| index    | int  | 否   |      |        |
| event_id | int  | 是   |      |        |

#### 错误代码

| 代码 | 说明                       |
| ---- | -------------------------- |
| 0    | 加载成功                   |
| 1    | 内部服务器错误，日志已记录 |
| 9    | 找不到这项活动             |
| 4    | 权限不足                   |
| 3    | token 无效                 |

#### 响应示例

``` json5
{
    "code": 0,
    "msg": "OK",
    "data": [
        {
            uid: 12,
            avatar: "https://",
            nickName: "微信昵称/昵称",
            realName: "真实姓名",
            studentId: "学号",
        },
        // ...
    ]
}
```



### [POST]   /event/{event_id}/participant

报名参加活动。

#### 权限要求

认证用户。

#### 参数

| 参数     | 类型 | 必填 | 释义 | 合法值 |
| -------- | ---- | ---- | ---- | ------ |
| event_id | int  | 是   |      |        |

#### 错误代码

| 代码 | 说明                       |
| ---- | -------------------------- |
| 0    | 加载成功                   |
| 1    | 内部服务器错误，日志已记录 |
| 9    | 找不到这项活动             |
| 4    | 权限不足                   |
| 3    | token 无效                 |

#### 响应示例

``` json
{
    "code": 0,
    "msg": "OK",
    "data": {},
}
```



### [GET]   /user/{uid}/event

获得单一用户参加的活动的列表

#### 权限要求

当前用户或管理员。

#### 参数

| 参数     | 类型 | 必填 | 释义 | 合法值 |
| -------- | ---- | ---- | ---- | ------ |
| pageSize | int  | 否   |      |        |
| index    | int  | 否   |      |        |

#### 错误代码

| 代码 | 说明                       |
| ---- | -------------------------- |
| 0    | 加载成功                   |
| 1    | 内部服务器错误，日志已记录 |
| 5    | 找不到用户                 |
| 4    | 权限不足                   |
| 3    | 给定的 token 无效          |

#### 响应示例

``` json5
{
    "code": 0,
    "msg": "OK",
    "data": [
        {
            event_id: 12,
            title: "",
            place: "",
            startTime: 1586258508,
            attendence: true,  // 签到成功
        },
        // ..
    ]
}
```



### [POST]   /event/{event_id}/user/{uid}/record

新增签到记录。

#### 权限要求

普通用户。

#### 参数

| 参数     | 类型 | 必填 | 释义     | 合法值 |
| -------- | ---- | ---- | -------- | ------ |
| signType | int2 | 是   | 记录类型 |        |

#### 错误代码

| 代码 | 说明                       |
| ---- | -------------------------- |
| 0    | 加载成功                   |
| 1    | 内部服务器错误，日志已记录 |
| 2    | 缺少必须的参数             |
| 3    | 给定的 token 无效          |
| 4    | 权限不足                   |
| 5    | 找不到用户                 |
| 9    | 找不到活动                 |
| 10   | 需要实名认证               |

#### 响应示例

```json
{
    "code": 0,
    "msg": "OK",
    "data": [
        {
            signTime: 11111111,
            signType: 1,
        },
        // ...
    ]
}
```

