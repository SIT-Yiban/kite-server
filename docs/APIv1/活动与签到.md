## 概念

签到相关API有四个概念，Event、User、Record、Tag 分别表示活动、用户、签到记录与实体 RFID 标签。在小程序的实现中，Tag 仅**保留**。

TODO：传附件

操作的资源主要有：

接口 | 说明
---- | ----
`/event`                              | 新建、列出、删除活动
`/event/{event_id}`                   | 撤销、编辑活动，查看活动详情
`/event/{event_id}/user`              | 列出活动参与者及参与状况（不支持删除记录）、申请活动
`/event/{event_id}/participant`       | 新建、列出活动报名人员
`/event/{event_id}/user/{uid}/record` | 列出、新建签到记录
`/event/sc`                           | 查询第二课堂活动列表
`/event/sc/{activity_id}`             | 查询第二课堂活动详情
`/event/sc/score/summary`             | 查询第二课堂得分
`/event/sc/score`                     | 查询第二课堂得分加分的详情列表
`/event/sc/{activity_id}/apply`       | 申请第二课堂活动
`/user/{uid}/event`                   | 列出用户参与的活动（不支持删除记录）



## 接口

### [POST] /event

新建一个活动。

#### 权限

实名认证用户。

#### 参数

| 参数          | 类型   | 必填 | 释义                 | 合法值            |
| ------------- | ------ | ---- | -------------------- | ----------------- |
| title         | string | 是   | 活动标题             |                   |
| description   | string | 是   | 活动描述             |                   |
| startTime     | int64  | 是   | 活动开始时间         | 不得早于当前时间  |
| endTime       | int64  | 是   | 活动结束时间         | 不得早于开始时间  |
| tag           | string | 是   | 活动分类             | 机器人爱好者协会  |
| maxPeople     | int2   | 是   | 最大参与人数         | 默认为无限制      |
| ~~needSign~~  | bool   | 是   | 是否开启签到         | 默认为 false      |
| ~~signType~~  | int    | 是   | 签到类型             | 1 表示扫码<br/>2 表示动态口令<br/>3 表示 RFID 标签 |
| ~~needApply~~ | bool   | 是   | 是否需要报名才能签到 | 默认为 false      |
| place         | string | 是   | 地点                 |                   |
| image         | uuid   | 是   | 题图                 |                   |
| attachment    | uuid[] | 否   | 详细介绍中的图片     |                   |

#### 错误代码

| 代码 | 说明                                   |
| ---- | -------------------------------------- |
| 0    | 成功创建                               |
| 1    | 内部服务器错误                         |
| 2    | 参数错误，可能是缺少字段，或分类不存在 |
| 4    | 权限不足，可能是未登录                 |
| 8    | 该活动已存在                           |

#### 响应示例

``` jsonc
{
    "code": 0,
    "msg": "OK",
    "data": { "event_id": 12 }
}
```



### [GET] /event

获取活动列表。

#### 权限

访客。

#### 参数

| 参数     | 类型   | 必填 | 释义     | 合法值           |
| -------- | ------ | ---- | -------- | ---------------- |
| pageSize | u32    | 否   | 单页大小 | 默认值由后端决定 |
| index    | u32    | 否   | 页索引   | 默认值由后端决定 |
| filter   | string | 否   | 关键字   | 词语或单词，不支持搜索语法 |
| // tags  | string | 否   | 分类     |  |

#### 错误代码

| 代码 | 说明                       |
| ---- | -------------------------- |
| 0    | 搜索成功                   |
| 1    | 内部服务器错误，日志已记录 |

#### 响应示例

```jsonc
{
    "code": 0,
    "msg": "OK",
    "data": [
        {
            event_id: 12,
            publisher: "somebody",
            title: "",
            place: "",
            startTime: 1586258508,
            endTime: 1586258509,
            tag: "机协",
        },
        // ...
    ]
}
```



### [DELETE] /event

删除一个活动。

#### 权限

发起者或管理员。

#### 参数

| 参数     | 类型 | 必填 | 释义    | 合法值  |
| -------- | ---- | ---- | ------- | ------- |
| event_id | int  | 是   | 活动 ID |         |

#### 错误代码

| 代码 | 说明                         |
| ---- | ---------------------------- |
| 0    | 成功标记为删除               |
| 1    | 内部服务器错误，日志已记录   |
| 2    | 参数错误，可能是缺少必要字段 |
| 3    | 给定的 token 无效            |
| 9    | 找不到这个活动，已经被删除   |

#### 响应示例

```jsonc
{
    "code": 0,
    "msg": "OK",
    "data": {}
}
```



### [GET] /event/{event_id}

获取某个活动的详细信息。

#### 权限

已登录用户。

#### 参数

<!==
| 参数 | 类型 | 必填 | 释义 | 合法值 |
| ---- | ---- | ---- | ---- | ------ |
|      |      |      |      |        |
-->

#### 错误代码

| 代码 | 说明                       |
| ---- | -------------------------- |
| 0    | 加载成功                   |
| 1    | 内部服务器错误，日志已记录 |
| 9    | 找不到这项活动             |

#### 响应示例

``` jsonc
{
    "code": 0,
    "msg": "OK",
    "data": [
        {
            "event_id": 12,
            "publisherId": 11,
            "publisher": "somebody",
            "publisherAvatar": "https://...",
            "title": "",
            "description": "...",
            "place": "工训一馆 403",
            "startTime": 1586258508,
            "endTime": 1586258509,
            "maxPeople": 200,
            "currentPeople": 20, // TODO
        }, // ...
    ]
}
```



### [GET] /event/{event_id}/participant

获取报名某个活动的人员。

#### 权限要求

活动发起者或管理员。

#### 参数

| 参数     | 类型 | 必填 | 释义 | 合法值 |
| -------- | ---- | ---- | ---- | ------ |
| pageSize | int  | 否   |      |        |
| index    | int  | 否   |      |        |
| event_id | int  | 是   |      |        |

#### 错误代码

| 代码 | 说明                       |
| ---- | -------------------------- |
| 0    | 加载成功                   |
| 1    | 内部服务器错误，日志已记录 |
| 9    | 找不到这项活动             |
| 4    | 权限不足                   |
| 3    | token 无效                 |

#### 响应示例

``` jsonc
{
    "code": 0,
    "msg": "OK",
    "data": [
        {
            "uid": 12,
            "avatar": "https://...",
            "nickName": "微信昵称/昵称",
            "realName": "真实姓名",
            "studentId": "学号",
        }, // ...
    ]
}
```



### [POST] /event/{event_id}/participant

报名参加活动。

#### 权限要求

认证用户。

#### 参数

| 参数     | 类型 | 必填 | 释义 | 合法值 |
| -------- | ---- | ---- | ---- | ------ |
| event_id | int  | 是   |      |        |

#### 错误代码

| 代码 | 说明                       |
| ---- | -------------------------- |
| 0    | 加载成功                   |
| 1    | 内部服务器错误，日志已记录 |
| 9    | 找不到这项活动             |
| 4    | 权限不足                   |
| 3    | token 无效                 |

#### 响应示例

``` json
{
    "code": 0,
    "msg": "OK",
    "data": {}
}
```



### [POST] /event/{event_id}/user/{uid}/record

新增签到记录。

#### 权限要求

普通用户。

#### 参数

| 参数     | 类型 | 必填 | 释义     | 合法值 |
| -------- | ---- | ---- | -------- | ------ |
| signType | int2 | 是   | 记录类型 |        |

#### 错误代码

| 代码 | 说明                       |
| ---- | -------------------------- |
| 0    | 加载成功                   |
| 1    | 内部服务器错误，日志已记录 |
| 2    | 缺少必须的参数             |
| 3    | 给定的 token 无效          |
| 4    | 权限不足                   |
| 5    | 找不到用户                 |
| 9    | 找不到活动                 |
| 10   | 需要实名认证               |

#### 响应示例

```jsonc
{
    "code": 0,
    "msg": "OK",
    "data": [
        {
            "signTime": 11111111,
            "signType": 1,
        }, // ...
    ]
}
```

### [GET] /event/sc

获取第二课堂活动列表

#### 权限要求

已实名用户

#### 参数

| 参数   | 类型 | 必填 | 释义          | 合法值    |
| ----- | ---- | --- | ------------- | ------- |
| index | 整数 | 否   | 页码          | 不小于 1  |
| count | 整数 | 否   | 每页最大条目数  | 不超过 20 |

#### 响应示例

```jsonc
{
  "code": 0,
  "data": {
    "activityList": [
      {
        "activityId": 1067967,
        "title": "【艺术学院】365宣讲会",
        "startTime": "2021-09-26T18:00:00+08:00",
        "duration": "120 分钟"
      },
      {
        "activityId": 1067943,
        "title": "【艺术学院】安泊话剧社配音比赛附加分",
        "startTime": "2021-09-22T10:00:00+08:00",
        "duration": "120分钟 分钟"
      },
      {
        "activityId": 1067728,
        "title": "【电气学院】毕业晚会演职人员",
        "startTime": "2021-07-06T17:32:25+08:00",
        "duration": "150 分钟"
      }, //...
    ]
  }
}
```

#### 返回值

| 返回值          | 类型             | 释义           |
| -------------- | --------------- | -------------  |
| activityId    | i32             | 活动编号        |
| title          | String          | 标题           |
| startTime     | DateTime<Local> | 活动开始时间    |
| duration       | Option<String>  | 活动持续时间    |

### [GET] /event/sc/{activity_id}

获取第二课堂活动详情

#### 权限要求

已实名用户

#### 参数

| 参数         | 类型 | 必填  | 释义           | 合法值   |
| ----------- | ---- | ---- | ------------- | -------- |
| activity_id | 整数  | 是   | 活动编码        |         |

#### 响应示例

```jsonc
{
  "code": 0,
  "data": {
    "activityDetail": {
      "activityId": 1046235,
      "category": 1,
      "title": "2018上海警示文化进校园——海湾三校专场演出",
      "startTime": "2018-04-19T18:00:00+08:00",
      "signStartTime": "2018-04-19T17:50:18+08:00",
      "signEndTime": "2018-04-19T20:06:30+08:00",
      "place": "华东理工大学奉贤校区敬贤堂",
      "duration": "80 分钟",
      "manager": "陈贝妮",
      "contact": "60873213",
      "organizer": "校团委",
      "undertaker": ".",
      "description": "<p class=\"MsoNormal\"> <b><span style=\"font-size:14.0pt;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <img src=\"ff24d656-e451-46f7-8cb1-673a3f9f7014.png\" alt=\"\"></span></b><br> <b><span style=\"font-size:14.0pt;\"></span></b><b><span style=\"font-size:14.0pt;\"></span></b> </p> <p align=\"center\" class=\"MsoNormal\"> <span style=\"font-size:14.0pt;font-family:宋体;\">美丽中国</span><span style=\"font-size:14.0pt;\"><span>&nbsp; </span></span><span style=\"font-size:14.0pt;font-family:宋体;\">健康生活</span><span style=\"font-size:14.0pt;\"></span> </p> <p class=\"MsoNormal\"> <span style=\"font-size:14.0pt;\"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ——</span>2018</span><span style=\"font-size:14.0pt;font-family:宋体;\">上海警示文化进校园活动</span><span style=\"font-size:14.0pt;\"></span><span style=\"font-size:14.0pt;font-family:宋体;\">时间：</span><span style=\"font-size:14.0pt;\">2018</span><span style=\"font-size:14.0pt;font-family:宋体;\">年4月19日 18：30</span><span style=\"font-size:14.0pt;font-family:宋体;\"><br> </span> </p> <p class=\"MsoNormal\"> <span style=\"font-size:14.0pt;font-family:宋体;\">地点：华东理工大学奉贤校区敬贤堂</span><span style=\"font-size:14.0pt;\"></span> </p> <span style=\"font-size:14.0pt;font-family:宋体;\"></span><span style=\"font-size:14.0pt;\"></span> <p class=\"MsoNormal\"> <span style=\"font-size:14.0pt;font-family:宋体;\">节目内容：</span><span style=\"font-size:14.0pt;\"></span><span style=\"font-size:14.0pt;\"><span></span></span><span style=\"font-size:14.0pt;font-family:宋体;\">法治宣传（重点新宪法、国家安全法）</span><span style=\"font-size:14.0pt;\"></span> </p> <p class=\"MsoNormal\"> <span style=\"font-size:14.0pt;\"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style=\"font-size:14.0pt;font-family:宋体;\">治安防范（防诈骗）</span><span style=\"font-size:14.0pt;\"></span> </p> <p class=\"MsoNormal\"> <span style=\"font-size:14.0pt;\"><span>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span></span><span style=\"font-size:14.0pt;font-family:宋体;\">反邪教（维稳，以上海反邪教文化快车积累为基础）</span><span style=\"font-size:14.0pt;\"></span> </p> <p class=\"MsoNormal\"> <span style=\"font-size:14.0pt;\"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style=\"font-size:14.0pt;font-family:宋体;\">公共安全（围绕热点，如救助、环境、艾滋等）</span><span style=\"font-size:14.0pt;\"></span> </p> <p class=\"MsoNormal\"> <span style=\"font-size:14.0pt;\"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span style=\"font-size:14.0pt;font-family:宋体;\">歌舞、杂技、魔术（丰富形式、积极向上）</span><span style=\"font-size:14.0pt;\"></span><span style=\"font-size:14.0pt;\"><br> </span> </p> <p class=\"MsoNormal\"> <span style=\"font-size:14.0pt;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <img alt=\"\" src=\"80054e22-e925-4fd2-87c9-87c23a834abf.png\"><br> </span><span style=\"font-size:14.0pt;font-family:宋体;\"></span><span style=\"font-size:14.0pt;\"></span> </p> <br> <div style=\"font-size:10px\"> </div> ",
      "image": [
        "https://kite.sunnysab.cn/sc/image/ff24d656-e451-46f7-8cb1-673a3f9f7014.png",
        "https://kite.sunnysab.cn/sc/image/80054e22-e925-4fd2-87c9-87c23a834abf.png"
      ]
    }
  }
}
```

#### 返回值

| 返回值           | 类型             | 释义          |
| --------------- | --------------- | ------------- |
| activityId     | i32             | 活动编号       |
| category        | i32             | 活动类型       |
| title           | String          | 标题           |
| startTime      | DateTime<Local> | 活动开始时间    |
| signStartTime | DateTime<Local> | 签到开始时间    |
| signEndTime   | DateTime<Local> | 签到结束时间    |
| place           | Option<String>  | 地点           |
| duration        | Option<String>  | 活动持续时间    |
| manager         | Option<String>  | 负责人         |
| contact         | Option<String>  | 联系电话       |
| organizer       | Option<String>  | 组织者         |
| undertaker      | Option<String>  | 承办人         |
| description     | String          | 正文           |
| image           | Vec<String>     | 图片url        |

### [GET] /event/sc/score/summary

获取第二课堂得分的情况

#### 权限要求

已实名用户

#### 响应示例

```jsonc
{
  "code": 0,
  "data": {
    "summary": {
      "total": 0.0,
      "themeReport": 0.0,
      "socialPractice": 0.0,
      "creativity": 0.0,
      "safetyCivilization": 0.0,
      "charity": 0.0,
      "campusCulture": 0.0
    }
  }
}
```

#### 返回值

| 返回值               | 类型 | 释义         |
| ------------------- | --- | ----------- |
| total               | f32 | 第二课堂总得分 |
| themeReport        | f32 | 主题报告      |
| socialPractice     | f32 | 社会实践      |
| creativity          | f32 | 创新创业创意   |
| safetyCivilization | f32 | 校园安全文明   |
| charity             | f32 | 公益志愿      |
| campusCulture      | f32 | 校园文化      |

### [GET] /event/sc/score

获取第二课堂得分加分的详情列表

#### 权限要求

已实名用户

#### 参数

| 参数     | 类型 | 必填 | 释义                      | 合法值        |
| ------- | ---- | ---- | ----------------------- | ------------  |
| force   | bool | 是   |  是否进行网页查询存入数据库  | true or false |

#### 响应示例

```jsonc
    {
  "code": 0,
  "data": {
    "detail": [
      {
        "activityId": 1068217,
        "title": "【沐曦青年服务队】10月10日冬令送温暖志愿活动",
        "time": "2021-10-10T20:53:08+08:00",
        "status": "通过",
        "amount": 0.1599999964237213,
        "category": 5
      },
      {
        "activityId": 1067223,
        "title": "仲夏夜之歌——校大学生艺术团弦乐团专场演出",
        "time": "2021-05-31T23:40:35+08:00",
        "status": "通过",
        "amount": 0.15000000596046448,
        "category": 7
      },
      {
        "activityId": 1066909,
        "title": "2020-2021学年第一学期1-15宿舍校园文明加分",
        "time": "2021-05-18T12:26:37+08:00",
        "status": "通过",
        "amount": 0.10000000149011612,
        "category": 4
      }, //...
    ]
  }
}
```

### [POST] /event/sc/{activity_id}/apply

申请第二课堂活动

#### 权限要求

已实名用户

#### 参数

| 参数         | 类型 | 必填  | 释义           | 合法值                                  |
| ----------- | ---- | ---- | ------------- | -------------------------------------- |
| activity_id | 整数  | 是   | 活动编码        |                                       |
| force       | bool | 是 ｜ 是否启用强制模式 ｜ true: 启动强制模式 false: 不使用强制模式 |

#### 响应示例

```jsonc
{
  "code": 0,
  "data": {
    "scActivityApply": "申请成功"
  }
}

{
  "code": 0,
  "data": {
    "scActivityApply": "您已申请过该活动，不能重复申请！"
  }
}
```

### [GET] /user/{uid}/event

获取单一用户参加的活动的列表

#### 权限要求

当前用户或管理员。

#### 参数

| 参数     | 类型 | 必填 | 释义 | 合法值 |
| -------- | ---- | ---- | ---- | ------ |
| pageSize | int  | 否   |      |        |
| index    | int  | 否   |      |        |

#### 错误代码

| 代码 | 说明                       |
| ---- | -------------------------- |
| 0    | 加载成功                   |
| 1    | 内部服务器错误，日志已记录 |
| 5    | 找不到用户                 |
| 4    | 权限不足                   |
| 3    | 给定的 token 无效          |

#### 响应示例

``` jsonc
{
    "code": 0,
    "msg": "OK",
    "data": [
        {
            "event_id": 12,
            "title": "",
            "place": "",
            "startTime": 1586258508,
            "attendence": true, // 是否已签到
        }, // ..
    ]
}
```
